<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEDx Shift Manager</title>
    <style>
        /* --- CSS Variables --- */
        :root {
            --ted-red: #E62B1E;
            --bg-color: #f8f9fa;
            --header-bg: #ffffff;
            --text-main: #1a1a1a;
            --text-sub: #666666;
            --line-color: #e0e0e0;
            --line-sub-color: #eeeeee;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            
            --hour-height: 120px; /* 5åˆ†=10px */
            --time-col-width: 50px;
            --col-min-width: 140px; /* 1äººåˆ†ã®åˆ—å¹… */
            
            --role-reception: #ffebee;
            --role-stage: #e1f5fe;
            --role-stream: #e8f5e9;
            --role-venue: #fffde7;
            --role-default: #f3e5f5;
        }

        [data-theme="dark"] {
            --bg-color: #121212;
            --header-bg: #1e1e1e;
            --text-main: #ffffff;
            --text-sub: #aaaaaa;
            --line-color: #333333;
            --line-sub-color: #222222;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            
            --role-reception: #4a2020;
            --role-stage: #203a4a;
            --role-stream: #204a25;
            --role-venue: #4a4520;
            --role-default: #34204a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header UI --- */
        header {
            background: var(--header-bg);
            padding: 10px 15px;
            border-bottom: 1px solid var(--line-color);
            z-index: 200;
        }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        h1 { font-size: 1.1rem; font-weight: 800; }
        h1 span { color: var(--ted-red); }
        .theme-toggle { background: none; border: none; cursor: pointer; font-size: 1.2rem; }
        
        .controls { display: flex; gap: 8px; }
        .filter-input {
            width: 100%; padding: 8px 12px; border-radius: 6px;
            border: 1px solid var(--line-color); background: var(--bg-color); color: var(--text-main);
        }

        /* --- Date Tabs --- */
        .tabs {
            display: flex; overflow-x: auto; background: var(--header-bg);
            border-bottom: 1px solid var(--line-color); flex-shrink: 0;
        }
        .tab {
            padding: 10px 20px; font-size: 0.9rem; font-weight: bold; color: var(--text-sub);
            cursor: pointer; border-bottom: 3px solid transparent; white-space: nowrap;
        }
        .tab.active { color: var(--ted-red); border-bottom-color: var(--ted-red); }

        /* --- Grid Layout --- */
        .grid-container {
            flex-grow: 1;
            overflow: auto; /* ä¸¡æ–¹å‘ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
            position: relative;
            background: var(--bg-color);
            display: grid;
            /* å·¦ç«¯ï¼ˆæ™‚é–“ï¼‰ + ãƒ¡ãƒ³ãƒãƒ¼æ•°åˆ†ã®åˆ—ï¼ˆJSã§è¨­å®šï¼‰ */
            grid-template-columns: var(--time-col-width) repeat(var(--col-count, 1), minmax(var(--col-min-width), 1fr));
            /* ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ + ãƒœãƒ‡ã‚£è¡Œ */
            grid-template-rows: 40px 1fr; 
        }

        /* å·¦ä¸Šã®è§’ï¼ˆå›ºå®šï¼‰ */
        .corner-cell {
            position: sticky; top: 0; left: 0; z-index: 30;
            background: var(--header-bg);
            border-bottom: 1px solid var(--line-color);
            border-right: 1px solid var(--line-color);
        }

        /* ãƒ¡ãƒ³ãƒãƒ¼åãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆä¸Šéƒ¨å›ºå®šï¼‰ */
        .member-header {
            position: sticky; top: 0; z-index: 20;
            background: var(--header-bg);
            border-bottom: 1px solid var(--line-color);
            border-right: 1px solid var(--line-color);
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 0.9rem;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        /* æ™‚é–“è»¸ï¼ˆå·¦å´å›ºå®šï¼‰ */
        .time-sidebar {
            grid-row: 2; grid-column: 1;
            position: sticky; left: 0; z-index: 20;
            background: var(--header-bg);
            border-right: 1px solid var(--line-color);
        }
        .time-slot {
            height: var(--hour-height);
            text-align: right; padding-right: 5px;
            font-size: 0.7rem; color: var(--text-sub);
            position: relative;
        }
        .time-slot span { position: relative; top: -6px; display: block; background: var(--header-bg); }

        /* ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ï¼ˆåˆ—ã”ã¨ï¼‰ */
        .member-column {
            grid-row: 2;
            position: relative;
            border-right: 1px solid var(--line-color);
            /* ã‚°ãƒªãƒƒãƒ‰èƒŒæ™¯ */
            background-image: 
                linear-gradient(var(--line-color) 1px, transparent 1px),
                linear-gradient(var(--line-sub-color) 1px, transparent 1px);
            background-size: 
                100% var(--hour-height), 
                100% calc(var(--hour-height) / 2);
            background-position: 0 0;
        }

        /* ç¾åœ¨æ™‚åˆ»ç·š (å„ã‚«ãƒ©ãƒ ã«è¡¨ç¤ºã™ã‚‹ç°¡æ˜“å®Ÿè£…ç‰ˆ) */
        .now-line {
            position: absolute; width: 100%; height: 2px;
            background: var(--ted-red); pointer-events: none; z-index: 10;
        }

        /* --- Shift Cards --- */
        .shift-card {
            position: absolute;
            left: 4px; right: 4px; /* åˆ—å¹…ã«åˆã‚ã›ã¦æ¨ªå¹…ã„ã£ã±ã„ */
            background: var(--header-bg);
            border-radius: 6px; padding: 6px;
            box-shadow: var(--shadow);
            border-left: 4px solid transparent;
            font-size: 0.8rem; overflow: hidden;
            display: flex; flex-direction: column;
            cursor: pointer;
            transition: 0.2s;
        }
        
        .role-reception { background-color: var(--role-reception); border-left-color: #d32f2f; }
        .role-stage { background-color: var(--role-stage); border-left-color: #0288d1; }
        .role-stream { background-color: var(--role-stream); border-left-color: #388e3c; }
        .role-venue { background-color: var(--role-venue); border-left-color: #fbc02d; }
        .role-other { background-color: var(--role-default); border-left-color: #7b1fa2; }

        .card-role { 
            font-size: 0.7rem; font-weight: bold; opacity: 0.8; margin-bottom: 2px;
            display: inline-block; padding: 2px 4px; background: rgba(255,255,255,0.5); border-radius: 4px;
        }
        .card-time { font-size: 0.7rem; color: var(--text-sub); margin-bottom: 2px; font-family: monospace;}
        .card-title { font-weight: 700; font-size: 0.85rem; line-height: 1.2; margin-bottom: auto;}
        .card-loc { font-size: 0.7rem; color: var(--text-sub); margin-top: 4px; text-align: right; }

        /* Filter Hidden State */
        .hidden-col { display: none; }
    </style>
</head>
<body>

<header>
    <div class="top-bar">
        <h1><span>TEDx</span> Shift Manager</h1>
        <button class="theme-toggle" id="themeToggle">ğŸŒ™</button>
    </div>
    <div class="controls">
        <input type="text" id="nameFilter" class="filter-input" placeholder="åå‰ã§åˆ—ã‚’çµã‚Šè¾¼ã¿...">
    </div>
</header>

<div class="tabs" id="dateTabs"></div>

<!-- ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒ†ãƒŠ -->
<div class="grid-container" id="gridContainer">
    <div class="corner-cell"></div>
    <!-- JSã§ã“ã“ã«è¡Œã¨åˆ—ã‚’è¿½åŠ  -->
</div>

<script>
    // --- Sample Data ---
    const rawData = [
        { "date": "Day1", "name": "å±±ç”°", "role": "å—ä»˜", "title": "æ¥å ´è€…å—ä»˜", "start": "09:30", "end": "12:00", "location": "ã‚¨ãƒ³ãƒˆãƒ©ãƒ³ã‚¹" },
        { "date": "Day1", "name": "éˆ´æœ¨", "role": "ç™»å£‡è£œåŠ©", "title": "Session 1 æº–å‚™", "start": "10:00", "end": "11:30", "location": "ãƒ›ãƒ¼ãƒ«A" },
        { "date": "Day1", "name": "ä½è—¤", "role": "é…ä¿¡", "title": "CMé€å‡ºãƒ†ã‚¹ãƒˆ", "start": "09:55", "end": "10:05", "location": "é…ä¿¡å“" },
        { "date": "Day1", "name": "å±±ç”°", "role": "å—ä»˜", "title": "é…åˆ»è€…å¯¾å¿œ", "start": "13:00", "end": "14:35", "location": "ã‚¨ãƒ³ãƒˆãƒ©ãƒ³ã‚¹" },
        { "date": "Day1", "name": "ç”°ä¸­", "role": "è¨­å–¶", "title": "ãƒ©ãƒ³ãƒä¼šå ´è¨­å–¶", "start": "11:15", "end": "12:45", "location": "ãƒ›ãƒ¯ã‚¤ã‚¨" },
        { "date": "Day1", "name": "é«˜æ©‹", "role": "ã‚¢ãƒ†ãƒ³ãƒ‰", "title": "ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ç§»å‹•", "start": "10:35", "end": "12:45", "location": "æ§ãˆå®¤" },
        { "date": "Day1", "name": "ä¼Šè—¤", "role": "è¨­å–¶", "title": "å‚™å“æ¬å…¥", "start": "09:00", "end": "10:00", "location": "æ¬å…¥å£" },
        
        { "date": "Day2", "name": "å±±ç”°", "role": "æ’¤å", "title": "å…¨ä½“ç‰‡ä»˜ã‘", "start": "18:00", "end": "20:00", "location": "å…¨é¤¨" },
        { "date": "Day2", "name": "éˆ´æœ¨", "role": "é…ä¿¡", "title": "Session 2 æœ¬ç•ª", "start": "13:00", "end": "15:00", "location": "é…ä¿¡å“" }
    ];

    // --- Config ---
    const START_HOUR = 8;
    const END_HOUR = 21;
    const HOUR_HEIGHT = 120; // px

    let currentTab = "";
    let uniqueDates = [];
    let currentMembers = []; // è¡¨ç¤ºä¸­ã®æ—¥ã®ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆ

    document.addEventListener('DOMContentLoaded', () => {
        initData();
        setupTabs();
        renderGrid(currentTab);
        setupFilter();
        setupTheme();
        
        // ç¾åœ¨æ™‚åˆ»ç·šæ›´æ–°ãƒ«ãƒ¼ãƒ—
        setInterval(updateNowLines, 60000);
        
        // åˆæœŸã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®
        setTimeout(() => {
            const container = document.getElementById('gridContainer');
            if(container) container.scrollTop = 100;
        }, 100);
    });

    function initData() {
        uniqueDates = Array.from(new Set(rawData.map(d => d.date)));
        if (uniqueDates.length > 0) currentTab = uniqueDates[0];
    }

    function setupTabs() {
        const container = document.getElementById('dateTabs');
        container.innerHTML = uniqueDates.map(date => 
            `<div class="tab ${date === currentTab ? 'active' : ''}" onclick="switchTab('${date}')">${date}</div>`
        ).join('');
    }

    window.switchTab = (date) => {
        currentTab = date;
        document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.innerText === date));
        renderGrid(date);
    };

    // --- Grid Rendering ---
    function renderGrid(date) {
        const container = document.getElementById('gridContainer');
        
        // ãã®æ—¥ã®ãƒ‡ãƒ¼ã‚¿ã¨ãƒ¡ãƒ³ãƒãƒ¼æŠ½å‡º
        const daysEvents = rawData.filter(d => d.date === date);
        const membersSet = new Set(daysEvents.map(e => e.name));
        currentMembers = Array.from(membersSet).sort(); // åå‰é †

        // Gridè¨­å®šæ›´æ–°: æ™‚é–“åˆ— + ãƒ¡ãƒ³ãƒãƒ¼æ•°
        container.style.setProperty('--col-count', currentMembers.length);
        
        // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¯ãƒªã‚¢ï¼ˆã‚³ãƒ¼ãƒŠãƒ¼ã‚»ãƒ«ä»¥å¤–ï¼‰
        container.innerHTML = '<div class="corner-cell"></div>';

        // 1. ãƒ¡ãƒ³ãƒãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ç”Ÿæˆ (Grid Row 1)
        currentMembers.forEach((member, index) => {
            const header = document.createElement('div');
            header.className = 'member-header';
            header.innerText = member;
            header.dataset.member = member; // ãƒ•ã‚£ãƒ«ã‚¿ç”¨
            // Gridé…ç½®: æ™‚é–“åˆ—(1)ã®æ¬¡ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ
            header.style.gridColumn = index + 2; 
            header.style.gridRow = 1;
            container.appendChild(header);
        });

        // 2. æ™‚é–“è»¸ã‚µã‚¤ãƒ‰ãƒãƒ¼ç”Ÿæˆ (Grid Row 2, Col 1)
        const timeSidebar = document.createElement('div');
        timeSidebar.className = 'time-sidebar';
        let timeHtml = '';
        for (let h = START_HOUR; h <= END_HOUR; h++) {
            timeHtml += `<div class="time-slot"><span>${h}:00</span></div>`;
        }
        timeSidebar.innerHTML = timeHtml;
        // æ™‚é–“è»¸å…¨ä½“ã®é«˜ã•ã‚’è¨­å®š
        timeSidebar.style.height = `${(END_HOUR - START_HOUR + 1) * HOUR_HEIGHT}px`;
        container.appendChild(timeSidebar);

        // 3. å„ãƒ¡ãƒ³ãƒãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆåˆ—ç”Ÿæˆ (Grid Row 2, Col n)
        currentMembers.forEach((member, index) => {
            const col = document.createElement('div');
            col.className = 'member-column';
            col.dataset.member = member; // ãƒ•ã‚£ãƒ«ã‚¿ç”¨
            col.style.gridColumn = index + 2;
            col.style.height = `${(END_HOUR - START_HOUR + 1) * HOUR_HEIGHT}px`;

            // ç¾åœ¨æ™‚åˆ»ç·šã‚’è¿½åŠ 
            const nowLine = document.createElement('div');
            nowLine.className = 'now-line';
            col.appendChild(nowLine);

            // ã“ã®ãƒ¡ãƒ³ãƒãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’é…ç½®
            const myEvents = daysEvents.filter(e => e.name === member);
            myEvents.forEach(evt => {
                const card = createCard(evt);
                col.appendChild(card);
            });

            container.appendChild(col);
        });

        updateNowLines();
        applyFilter(); // ãƒ•ã‚£ãƒ«ã‚¿çŠ¶æ…‹ã‚’å¾©å…ƒ
    }

    function createCard(evt) {
        const el = document.createElement('div');
        el.className = `shift-card ${getRoleClass(evt.role)}`;
        
        const top = getTopPosition(evt.start);
        const height = getDurationHeight(evt.start, evt.end);
        
        el.style.top = `${top}px`;
        el.style.height = `${Math.max(height, 20)}px`; // æœ€ä½é«˜ã•ã‚’ç¢ºä¿

        // ä¸­èº«ï¼ˆåå‰ã¯ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚ã‚‹ã®ã§å‰Šé™¤ï¼‰
        el.innerHTML = `
            <span class="card-role">${evt.role}</span>
            <div class="card-time">${evt.start}-${evt.end}</div>
            <div class="card-title">${evt.title}</div>
            <div class="card-loc">ğŸ“${evt.location}</div>
        `;
        return el;
    }

    // --- Helpers ---
    function timeToMinutes(str) {
        const [h, m] = str.split(':').map(Number);
        return h * 60 + m;
    }

    function getTopPosition(str) {
        const minutes = timeToMinutes(str) - (START_HOUR * 60);
        return (minutes / 60) * HOUR_HEIGHT;
    }

    function getDurationHeight(start, end) {
        const diff = timeToMinutes(end) - timeToMinutes(start);
        return (diff / 60) * HOUR_HEIGHT;
    }

    function getRoleClass(role) {
        if (role.includes("å—ä»˜")) return "role-reception";
        if (role.includes("ç™»å£‡") || role.includes("ã‚¢ãƒ†ãƒ³ãƒ‰")) return "role-stage";
        if (role.includes("é…ä¿¡")) return "role-stream";
        if (role.includes("è¨­å–¶") || role.includes("æ’¤å")) return "role-venue";
        return "role-other";
    }

    // --- Filter (åˆ—ã®è¡¨ç¤º/éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ) ---
    function setupFilter() {
        document.getElementById('nameFilter').addEventListener('input', applyFilter);
    }

    function applyFilter() {
        const query = document.getElementById('nameFilter').value.trim().toLowerCase();
        const headers = document.querySelectorAll('.member-header');
        const cols = document.querySelectorAll('.member-column');

        // è¡¨ç¤ºã™ã‚‹ãƒ¡ãƒ³ãƒãƒ¼ã‚’ç‰¹å®š
        const visibleMembers = currentMembers.filter(m => 
            query === "" || m.toLowerCase().includes(query)
        );

        // ã‚°ãƒªãƒƒãƒ‰å†æ§‹ç¯‰ã¯ã‚³ã‚¹ãƒˆãŒé«˜ã„ã®ã§ã€display:noneã§åˆ¶å¾¡
        // Gridã®å ´åˆã€columnç•ªå·ãŒãšã‚Œã‚‹ã®ã‚’é˜²ããŸã‚ã€DOMè¦ç´ è‡ªä½“ã¯æ®‹ã—ã¤ã¤
        // styleã§åˆ¶å¾¡ã™ã‚‹ãŒã€grid-template-columnsã®å†è¨ˆç®—ãŒå¿…è¦ã«ãªã‚‹å ´åˆãŒã‚ã‚‹ã€‚
        // ä»Šå›ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ã€éè©²å½“ã®è¦ç´ ã« hidden-col ã‚¯ãƒ©ã‚¹ã‚’ã¤ã‘ã‚‹ã€‚
        
        // CSS Gridã®ä»•æ§˜ä¸Šã€è¦ç´ ã‚’display:noneã™ã‚‹ã¨åˆ—ãŒè©°ã¾ã‚‹ã®ã§ã€
        // ã‚³ãƒ³ãƒ†ãƒŠã® grid-template-columns ã‚‚èª¿æ•´ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
        
        let visibleCount = 0;

        headers.forEach(h => {
            const isMatch = visibleMembers.includes(h.dataset.member);
            if(isMatch) {
                h.classList.remove('hidden-col');
                visibleCount++;
            } else {
                h.classList.add('hidden-col');
            }
        });

        cols.forEach(c => {
            const isMatch = visibleMembers.includes(c.dataset.member);
            if(isMatch) {
                c.classList.remove('hidden-col');
            } else {
                c.classList.add('hidden-col');
            }
        });

        // Gridã®ã‚«ãƒ©ãƒ å®šç¾©ã‚’æ›´æ–°ï¼ˆè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹æ•°ã ã‘ã«çµã‚‹ï¼‰
        const container = document.getElementById('gridContainer');
        container.style.setProperty('--col-count', visibleCount);
    }

    // --- Theme & Time ---
    function setupTheme() {
        const btn = document.getElementById('themeToggle');
        const html = document.documentElement;
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            html.setAttribute('data-theme', 'dark');
            btn.innerText = 'â˜€ï¸';
        }
        btn.addEventListener('click', () => {
            const isDark = html.getAttribute('data-theme') === 'dark';
            html.setAttribute('data-theme', isDark ? '' : 'dark');
            btn.innerText = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
        });
    }

    function updateNowLines() {
        const now = new Date();
        const currentH = now.getHours();
        const currentM = now.getMinutes();

        const lines = document.querySelectorAll('.now-line');
        
        if (currentH < START_HOUR || currentH > END_HOUR) {
            lines.forEach(l => l.style.display = 'none');
            return;
        }

        const min = (currentH * 60 + currentM) - (START_HOUR * 60);
        const top = (min / 60) * HOUR_HEIGHT;

        lines.forEach(l => {
            l.style.display = 'block';
            l.style.top = `${top}px`;
        });
    }
</script>
</body>
</html>