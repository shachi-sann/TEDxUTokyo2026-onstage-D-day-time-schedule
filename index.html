<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEDx Shift Manager</title>
    <style>
        /* --- CSS Variables --- */
        :root {
            --ted-red: #E62B1E;
            --ted-black: #1a1a1a;
            --bg-color: #f8f9fa;
            --header-bg: #ffffff;
            --modal-bg: #ffffff;
            --text-main: #1a1a1a;
            --text-sub: #666666;
            --line-color: #e0e0e0;
            --line-sub-color: #eeeeee;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --overlay-bg: rgba(0, 0, 0, 0.4);
            
            --hour-height: 120px; /* 5åˆ†=10px */
            --time-col-width: 50px;
            --col-min-width: 130px; /* åˆ—å¹… */
            
            /* Roles */
            --role-reception: #ffebee;
            --role-stage: #e1f5fe;
            --role-stream: #e8f5e9;
            --role-venue: #fffde7;
            --role-default: #f3e5f5;
        }

        [data-theme="dark"] {
            --bg-color: #121212;
            --header-bg: #1e1e1e;
            --modal-bg: #2c2c2c;
            --text-main: #ffffff;
            --text-sub: #aaaaaa;
            --line-color: #333333;
            --line-sub-color: #222222;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
            --overlay-bg: rgba(0, 0, 0, 0.7);
            
            --role-reception: #4a2020;
            --role-stage: #203a4a;
            --role-stream: #204a25;
            --role-venue: #4a4520;
            --role-default: #34204a;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            background: var(--header-bg);
            padding: 10px 15px;
            border-bottom: 1px solid var(--line-color);
            z-index: 200;
            flex-shrink: 0;
        }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        h1 { font-size: 1.1rem; font-weight: 800; }
        h1 span { color: var(--ted-red); }
        .theme-toggle { background: none; border: none; cursor: pointer; font-size: 1.2rem; }
        
        .controls input {
            width: 100%; padding: 8px 12px; border-radius: 6px;
            border: 1px solid var(--line-color); background: var(--bg-color); color: var(--text-main);
        }

        /* --- Tabs --- */
        .tabs {
            display: flex; overflow-x: auto; background: var(--header-bg);
            border-bottom: 1px solid var(--line-color); flex-shrink: 0;
        }
        .tab {
            padding: 10px 20px; font-size: 0.9rem; font-weight: bold; color: var(--text-sub);
            cursor: pointer; border-bottom: 3px solid transparent; white-space: nowrap;
        }
        .tab.active { color: var(--ted-red); border-bottom-color: var(--ted-red); }

        /* --- Grid Layout --- */
        .grid-container {
            flex-grow: 1;
            overflow: auto;
            position: relative;
            background: var(--bg-color);
            display: grid;
            grid-template-columns: var(--time-col-width) repeat(var(--col-count, 1), minmax(var(--col-min-width), 1fr));
            grid-template-rows: 40px 1fr; 
        }

        .corner-cell {
            position: sticky; top: 0; left: 0; z-index: 30;
            background: var(--header-bg);
            border-bottom: 1px solid var(--line-color);
            border-right: 1px solid var(--line-color);
        }

        .member-header {
            position: sticky; top: 0; z-index: 20;
            background: var(--header-bg);
            border-bottom: 1px solid var(--line-color);
            border-right: 1px solid var(--line-color);
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 0.9rem;
            white-space: nowrap; overflow: hidden;
        }

        .time-sidebar {
            grid-row: 2; grid-column: 1;
            position: sticky; left: 0; z-index: 20;
            background: var(--header-bg);
            border-right: 1px solid var(--line-color);
        }
        .time-slot {
            height: var(--hour-height);
            text-align: right; padding-right: 5px;
            font-size: 0.7rem; color: var(--text-sub);
        }
        .time-slot span { position: relative; top: -6px; display: block; background: var(--header-bg); }

        .member-column {
            grid-row: 2; position: relative;
            border-right: 1px solid var(--line-color);
            background-image: linear-gradient(var(--line-color) 1px, transparent 1px), linear-gradient(var(--line-sub-color) 1px, transparent 1px);
            background-size: 100% var(--hour-height), 100% calc(var(--hour-height) / 2);
            background-position: 0 0;
        }

        /* --- Shift Cards --- */
        .shift-card {
            position: absolute;
            /* Width and Left are set by JS now */
            background: var(--header-bg);
            border-radius: 6px; padding: 4px 6px;
            box-shadow: var(--shadow);
            border-left: 4px solid transparent;
            font-size: 0.8rem; overflow: hidden;
            display: flex; flex-direction: column;
            cursor: pointer;
            transition: transform 0.1s;
            z-index: 10;
        }
        .shift-card:active { transform: scale(0.98); }
        
        .role-reception { background: var(--role-reception); border-left-color: #d32f2f; }
        .role-stage { background: var(--role-stage); border-left-color: #0288d1; }
        .role-stream { background: var(--role-stream); border-left-color: #388e3c; }
        .role-venue { background: var(--role-venue); border-left-color: #fbc02d; }
        .role-other { background: var(--role-default); border-left-color: #7b1fa2; }

        .card-role { 
            font-size: 0.65rem; font-weight: bold; opacity: 0.8;
            display: inline-block; padding: 1px 4px; background: rgba(255,255,255,0.6); border-radius: 3px;
            margin-bottom: 2px; align-self: flex-start;
        }
        .card-time { font-size: 0.65rem; color: var(--text-sub); font-family: monospace; line-height: 1; margin-bottom: 2px;}
        .card-title { font-weight: 700; font-size: 0.8rem; line-height: 1.1; margin-bottom: auto;}

        /* --- Floating Action Button (FAB) --- */
        .fab {
            position: fixed; bottom: 20px; right: 20px;
            width: 56px; height: 56px; border-radius: 50%;
            background: var(--ted-red); color: white;
            border: none; box-shadow: 0 4px 10px rgba(230, 43, 30, 0.4);
            font-size: 2rem; display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 100; transition: transform 0.2s;
        }
        .fab:active { transform: scale(0.9); }

        /* --- Modals --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--overlay-bg); z-index: 500;
            display: none; align-items: flex-end; justify-content: center; /* Bottom sheet style on mobile */
        }
        .modal-overlay.open { display: flex; animation: fadeIn 0.2s; }
        
        /* PC adjustment */
        @media(min-width: 600px) {
            .modal-overlay { align-items: center; }
            .modal-content { border-radius: 12px !important; width: 400px !important; }
        }

        .modal-content {
            background: var(--modal-bg); width: 100%; max-width: 600px;
            border-radius: 20px 20px 0 0; padding: 25px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.2);
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-title { font-size: 1.2rem; font-weight: bold; }
        .close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-sub); }

        /* Form Elements */
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; font-size: 0.85rem; color: var(--text-sub); margin-bottom: 5px; }
        .form-input, .form-select {
            width: 100%; padding: 12px; border-radius: 8px;
            border: 1px solid var(--line-color); background: var(--bg-color); color: var(--text-main);
            font-size: 1rem;
        }
        .form-row { display: flex; gap: 10px; }
        .form-row > div { flex: 1; }

        .btn-primary {
            width: 100%; padding: 14px; background: var(--ted-red); color: white;
            border: none; border-radius: 8px; font-weight: bold; font-size: 1rem; cursor: pointer;
        }
        .btn-delete {
            width: 100%; padding: 14px; background: transparent; color: var(--text-sub);
            border: 1px solid var(--line-color); border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px;
        }

        /* Detail View Specifics */
        .detail-row { margin-bottom: 12px; border-bottom: 1px solid var(--line-color); padding-bottom: 8px; }
        .detail-label { font-size: 0.8rem; color: var(--text-sub); }
        .detail-value { font-size: 1.1rem; font-weight: 500; margin-top: 2px; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .hidden-col { display: none; }
    </style>
</head>
<body>

<header>
    <div class="top-bar">
        <h1><span>TEDx</span> Shift Manager</h1>
        <button class="theme-toggle" id="themeToggle">ğŸŒ™</button>
    </div>
    <div class="controls">
        <input type="text" id="nameFilter" placeholder="åå‰ã§åˆ—ã‚’çµã‚Šè¾¼ã¿...">
    </div>
</header>

<div class="tabs" id="dateTabs"></div>

<div class="grid-container" id="gridContainer">
    <div class="corner-cell"></div>
    <!-- Grid Content injected by JS -->
</div>

<!-- Floating Action Button -->
<button class="fab" id="addBtn" aria-label="Add Shift">ï¼‹</button>

<!-- Add Modal -->
<div class="modal-overlay" id="addModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">ã‚·ãƒ•ãƒˆè¿½åŠ </h2>
            <button class="close-btn" onclick="closeModal('addModal')">Ã—</button>
        </div>
        <form id="addForm">
            <div class="form-group">
                <label class="form-label">æ—¥ä»˜</label>
                <select id="addDate" class="form-select" required></select>
            </div>
            <div class="form-group">
                <label class="form-label">åå‰</label>
                <input type="text" id="addName" class="form-input" list="memberList" placeholder="ãƒ¡ãƒ³ãƒãƒ¼å" required>
                <datalist id="memberList"></datalist>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">é–‹å§‹</label>
                    <input type="time" id="addStart" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">çµ‚äº†</label>
                    <input type="time" id="addEnd" class="form-input" required>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">å½¹å‰²</label>
                <select id="addRole" class="form-select">
                    <option value="å—ä»˜">å—ä»˜</option>
                    <option value="ç™»å£‡è£œåŠ©">ç™»å£‡è£œåŠ©</option>
                    <option value="é…ä¿¡">é…ä¿¡</option>
                    <option value="è¨­å–¶">è¨­å–¶/æ’¤å</option>
                    <option value="ã‚¢ãƒ†ãƒ³ãƒ‰">ã‚¢ãƒ†ãƒ³ãƒ‰</option>
                    <option value="ãã®ä»–">ãã®ä»–</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">ä¼ç”»å / ã‚¿ã‚¹ã‚¯</label>
                <input type="text" id="addTitle" class="form-input" placeholder="ä¾‹ï¼šå—ä»˜å¯¾å¿œ" required>
            </div>
            <div class="form-group">
                <label class="form-label">å ´æ‰€</label>
                <input type="text" id="addLocation" class="form-input" placeholder="ä¾‹ï¼šã‚¨ãƒ³ãƒˆãƒ©ãƒ³ã‚¹">
            </div>
            <button type="submit" class="btn-primary">è¿½åŠ ã™ã‚‹</button>
        </form>
    </div>
</div>

<!-- Detail Modal -->
<div class="modal-overlay" id="detailModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">ã‚·ãƒ•ãƒˆè©³ç´°</h2>
            <button class="close-btn" onclick="closeModal('detailModal')">Ã—</button>
        </div>
        <div id="detailContent">
            <!-- Details injected here -->
        </div>
        <button class="btn-delete" id="deleteBtn">ã“ã®ã‚·ãƒ•ãƒˆã‚’å‰Šé™¤</button>
    </div>
</div>

<script>
    // --- Initial Data ---
    let rawData = [
        { "id": 1, "date": "Day1", "name": "å±±ç”°", "role": "å—ä»˜", "title": "æ¥å ´è€…å—ä»˜", "start": "09:30", "end": "12:00", "location": "ã‚¨ãƒ³ãƒˆãƒ©ãƒ³ã‚¹" },
        { "id": 2, "date": "Day1", "name": "éˆ´æœ¨", "role": "ç™»å£‡è£œåŠ©", "title": "Session 1 æº–å‚™", "start": "10:00", "end": "11:30", "location": "ãƒ›ãƒ¼ãƒ«A" },
        { "id": 3, "date": "Day1", "name": "å±±ç”°", "role": "å—ä»˜", "title": "VIPå¯¾å¿œ", "start": "10:00", "end": "11:00", "location": "VIPãƒ«ãƒ¼ãƒ " }, // é‡è¤‡ãƒ†ã‚¹ãƒˆç”¨
        { "id": 4, "date": "Day1", "name": "ä½è—¤", "role": "é…ä¿¡", "title": "CMé€å‡ºãƒ†ã‚¹ãƒˆ", "start": "09:55", "end": "10:05", "location": "é…ä¿¡å“" },
        { "id": 5, "date": "Day1", "name": "å±±ç”°", "role": "å—ä»˜", "title": "é…åˆ»è€…å¯¾å¿œ", "start": "13:00", "end": "14:35", "location": "ã‚¨ãƒ³ãƒˆãƒ©ãƒ³ã‚¹" },
        { "id": 6, "date": "Day1", "name": "ç”°ä¸­", "role": "è¨­å–¶", "title": "ãƒ©ãƒ³ãƒä¼šå ´è¨­å–¶", "start": "11:15", "end": "12:45", "location": "ãƒ›ãƒ¯ã‚¤ã‚¨" },
        { "id": 7, "date": "Day2", "name": "å±±ç”°", "role": "æ’¤å", "title": "å…¨ä½“ç‰‡ä»˜ã‘", "start": "18:00", "end": "20:00", "location": "å…¨é¤¨" }
    ];

    // --- Config ---
    const START_HOUR = 8;
    const END_HOUR = 21;
    const HOUR_HEIGHT = 120; 

    let currentTab = "Day1";
    let uniqueDates = [];
    let currentSelectedShiftId = null;

    document.addEventListener('DOMContentLoaded', () => {
        initApp();
        setupEvents();
    });

    function initApp() {
        refreshData();
        setupTabs();
        renderGrid(currentTab);
        setupTheme();
        
        // Populate Datalist
        updateDatalist();
    }

    function refreshData() {
        const dates = new Set(rawData.map(d => d.date));
        uniqueDates = Array.from(dates).sort();
        if(uniqueDates.length === 0) uniqueDates = ["Day1"];
        if(!uniqueDates.includes(currentTab)) currentTab = uniqueDates[0];
    }

    // --- Grid Rendering Logic (Updated for Overlaps) ---
    function renderGrid(date) {
        const container = document.getElementById('gridContainer');
        const daysEvents = rawData.filter(d => d.date === date);
        const membersSet = new Set(daysEvents.map(e => e.name));
        const currentMembers = Array.from(membersSet).sort();

        // 1. Setup Grid Columns
        container.style.setProperty('--col-count', currentMembers.length);
        container.innerHTML = '<div class="corner-cell"></div>';

        // 2. Headers
        currentMembers.forEach((member, index) => {
            const header = document.createElement('div');
            header.className = 'member-header';
            header.innerText = member;
            header.dataset.member = member;
            header.style.gridColumn = index + 2; 
            header.style.gridRow = 1;
            container.appendChild(header);
        });

        // 3. Time Sidebar
        const timeSidebar = document.createElement('div');
        timeSidebar.className = 'time-sidebar';
        timeSidebar.style.height = `${(END_HOUR - START_HOUR + 1) * HOUR_HEIGHT}px`;
        for (let h = START_HOUR; h <= END_HOUR; h++) {
            const slot = document.createElement('div');
            slot.className = 'time-slot';
            slot.innerHTML = `<span>${h}:00</span>`;
            timeSidebar.appendChild(slot);
        }
        container.appendChild(timeSidebar);

        // 4. Member Columns & Events
        currentMembers.forEach((member, index) => {
            const col = document.createElement('div');
            col.className = 'member-column';
            col.dataset.member = member;
            col.style.gridColumn = index + 2;
            col.style.height = `${(END_HOUR - START_HOUR + 1) * HOUR_HEIGHT}px`;

            // Filter events for this person only
            const myEvents = daysEvents.filter(e => e.name === member);
            
            // Calculate Overlaps (Packing) for this person
            const packedEvents = packEvents(myEvents);

            packedEvents.forEach(evt => {
                const card = createCard(evt);
                col.appendChild(card);
            });

            container.appendChild(col);
        });

        applyFilter();
    }

    // --- Overlap Calculation Algorithm (Column Packing) ---
    function packEvents(events) {
        // Sort by start time
        const sorted = [...events].sort((a, b) => timeToMinutes(a.start) - timeToMinutes(b.start));
        const columns = []; // Array of arrays (lanes)

        sorted.forEach(event => {
            let placed = false;
            // Try to place in an existing lane
            for (let i = 0; i < columns.length; i++) {
                const lastEventInLane = columns[i][columns[i].length - 1];
                if (timeToMinutes(lastEventInLane.end) <= timeToMinutes(event.start)) {
                    columns[i].push(event);
                    event.colIndex = i;
                    placed = true;
                    break;
                }
            }
            // Create new lane if needed
            if (!placed) {
                columns.push([event]);
                event.colIndex = columns.length - 1;
            }
        });

        // Calculate visual properties
        const maxCols = columns.length;
        sorted.forEach(event => {
            event.widthPct = 100 / maxCols;
            event.leftPct = (100 / maxCols) * event.colIndex;
        });

        return sorted;
    }

    function createCard(evt) {
        const el = document.createElement('div');
        el.className = `shift-card ${getRoleClass(evt.role)}`;
        
        const top = getTopPosition(evt.start);
        const height = getDurationHeight(evt.start, evt.end);
        
        // Apply calculated layout
        el.style.top = `${top}px`;
        el.style.height = `${Math.max(height, 20)}px`;
        el.style.width = `calc(${evt.widthPct}% - 4px)`;
        el.style.left = `calc(${evt.leftPct}% + 2px)`;

        el.innerHTML = `
            <span class="card-role">${evt.role}</span>
            <div class="card-time">${evt.start}-${evt.end}</div>
            <div class="card-title">${evt.title}</div>
        `;
        
        // Add Click Handler for Details
        el.onclick = () => openDetailModal(evt);
        
        return el;
    }

    // --- Helpers ---
    function timeToMinutes(str) {
        const [h, m] = str.split(':').map(Number);
        return h * 60 + m;
    }
    function getTopPosition(str) {
        const minutes = timeToMinutes(str) - (START_HOUR * 60);
        return (minutes / 60) * HOUR_HEIGHT;
    }
    function getDurationHeight(start, end) {
        const diff = timeToMinutes(end) - timeToMinutes(start);
        return (diff / 60) * HOUR_HEIGHT;
    }
    function getRoleClass(role) {
        if (role.includes("å—ä»˜")) return "role-reception";
        if (role.includes("ç™»å£‡") || role.includes("ã‚¢ãƒ†ãƒ³ãƒ‰")) return "role-stage";
        if (role.includes("é…ä¿¡")) return "role-stream";
        if (role.includes("è¨­å–¶") || role.includes("æ’¤å")) return "role-venue";
        return "role-other";
    }

    // --- UI Logic (Tabs, Filter, Theme) ---
    function setupTabs() {
        const container = document.getElementById('dateTabs');
        container.innerHTML = uniqueDates.map(date => 
            `<div class="tab ${date === currentTab ? 'active' : ''}" onclick="switchTab('${date}')">${date}</div>`
        ).join('');
    }
    window.switchTab = (date) => {
        currentTab = date;
        document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.innerText === date));
        renderGrid(date);
    };

    function setupEvents() {
        // Modal Toggles
        document.getElementById('addBtn').onclick = openAddModal;
        document.getElementById('addForm').onsubmit = handleAddSubmit;
        document.getElementById('deleteBtn').onclick = handleDelete;
        document.getElementById('nameFilter').addEventListener('input', applyFilter);
    }

    // --- Add Functionality ---
    function openAddModal() {
        const modal = document.getElementById('addModal');
        const dateSelect = document.getElementById('addDate');
        
        // Populate Date Select
        dateSelect.innerHTML = uniqueDates.map(d => `<option value="${d}">${d}</option>`).join('');
        dateSelect.value = currentTab; // Default to current tab
        
        // Reset fields
        document.getElementById('addName').value = '';
        document.getElementById('addStart').value = '10:00';
        document.getElementById('addEnd').value = '11:00';
        document.getElementById('addTitle').value = '';
        document.getElementById('addLocation').value = '';
        
        modal.classList.add('open');
    }

    function handleAddSubmit(e) {
        e.preventDefault();
        
        const newShift = {
            id: Date.now(), // Simple ID gen
            date: document.getElementById('addDate').value,
            name: document.getElementById('addName').value.trim(),
            start: document.getElementById('addStart').value,
            end: document.getElementById('addEnd').value,
            role: document.getElementById('addRole').value,
            title: document.getElementById('addTitle').value,
            location: document.getElementById('addLocation').value || 'æœªå®š'
        };

        if(!newShift.name) return;

        rawData.push(newShift);
        
        // Switch to the date of the new shift
        if(newShift.date !== currentTab) {
            currentTab = newShift.date;
        }

        closeModal('addModal');
        initApp(); // Re-render everything
    }

    function updateDatalist() {
        const list = document.getElementById('memberList');
        const names = new Set(rawData.map(d => d.name));
        list.innerHTML = Array.from(names).map(n => `<option value="${n}">`).join('');
    }

    // --- Detail & Delete Functionality ---
    function openDetailModal(evt) {
        currentSelectedShiftId = evt.id;
        const modal = document.getElementById('detailModal');
        const content = document.getElementById('detailContent');
        
        content.innerHTML = `
            <div class="detail-row">
                <div class="detail-label">åå‰</div>
                <div class="detail-value">${evt.name}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">æ—¥æ™‚</div>
                <div class="detail-value">${evt.date} / ${evt.start} - ${evt.end}</div>
            </div>
            <div class="detail-row">
                <div class="detail-label">å½¹å‰²</div>
                <div class="detail-value">${evt.role}</div>
            </div>
             <div class="detail-row">
                <div class="detail-label">ä¼ç”»å†…å®¹</div>
                <div class="detail-value">${evt.title}</div>
            </div>
            <div class="detail-row" style="border:none">
                <div class="detail-label">å ´æ‰€</div>
                <div class="detail-value">ğŸ“ ${evt.location}</div>
            </div>
        `;
        
        modal.classList.add('open');
    }

    function handleDelete() {
        if(!currentSelectedShiftId) return;
        if(confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
            rawData = rawData.filter(d => d.id !== currentSelectedShiftId);
            closeModal('detailModal');
            initApp();
        }
    }

    // --- Common ---
    window.closeModal = (id) => {
        document.getElementById(id).classList.remove('open');
    };

    function applyFilter() {
        const query = document.getElementById('nameFilter').value.trim().toLowerCase();
        const headers = document.querySelectorAll('.member-header');
        const cols = document.querySelectorAll('.member-column');

        let visibleCount = 0;
        headers.forEach(h => {
            const isMatch = h.dataset.member.toLowerCase().includes(query);
            if(isMatch) { h.classList.remove('hidden-col'); visibleCount++; }
            else { h.classList.add('hidden-col'); }
        });
        cols.forEach(c => {
            const isMatch = c.dataset.member.toLowerCase().includes(query);
            if(isMatch) c.classList.remove('hidden-col');
            else c.classList.add('hidden-col');
        });
        
        document.getElementById('gridContainer').style.setProperty('--col-count', visibleCount);
    }

    function setupTheme() {
        const btn = document.getElementById('themeToggle');
        const html = document.documentElement;
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            html.setAttribute('data-theme', 'dark');
            btn.innerText = 'â˜€ï¸';
        }
        btn.onclick = () => {
            const isDark = html.getAttribute('data-theme') === 'dark';
            html.setAttribute('data-theme', isDark ? '' : 'dark');
            btn.innerText = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
        };
    }
</script>
</body>
</html>
